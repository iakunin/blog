<!doctype html><html lang=en data-theme><head><meta charset=utf-8><meta name=HandheldFriendly content="True"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=referrer content="no-referrer-when-downgrade"><title>Exporting Prometheus metrics from the Debezium Kafka connector - Maksim Yakunin's blog</title>
<meta name=description content="In this article, we will take a step-by-step look at how to configure the Debezium Kafka connector so that it starts sending metrics in Prometheus format over the HTTP protocol.
We will make the configuration by customizing the Docker image. At the end of the article we will get a Docker image ready for further manipulation (including deployment to production)."><link rel=apple-touch-icon sizes=180x180 href=/favicons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicons/favicon-16x16.png><link rel=icon type=image/x-icon href=/favicon.ico><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/favicons/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://iakunin.dev/css/style.min.d584a32b747fab4b7ab3b1f66d4791759c3475dee03826c75ba5579a174126a0.css integrity="sha256-1YSjK3R/q0t6s7H2bUeRdZw0dd7gOCbHW6VXmhdBJqA="><script src=https://iakunin.dev/js/script.min.4179b537ed1cf9b7ce90f1fe3b27a8ca3e13118c1320394d4c7c36c55aeb5f34.js type=text/javascript integrity="sha256-QXm1N+0c+bfOkPH+Oyeoyj4TEYwTIDlNTHw2xVrrXzQ="></script><meta property="og:url" content="https://iakunin.dev/posts/debezium-kafka-connector-metrics/"><meta property="og:site_name" content="Maksim Yakunin's blog"><meta property="og:title" content="Exporting Prometheus metrics from the Debezium Kafka connector"><meta property="og:description" content="In this article, we will take a step-by-step look at how to configure the Debezium Kafka connector so that it starts sending metrics in Prometheus format over the HTTP protocol.
We will make the configuration by customizing the Docker image. At the end of the article we will get a Docker image ready for further manipulation (including deployment to production)."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-09-29T00:00:00+00:00"><meta property="article:modified_time" content="2024-09-29T00:00:00+00:00"><meta property="article:tag" content="Howto"><meta property="article:tag" content="Metrics"><meta property="article:tag" content="Prometheus"><meta property="article:tag" content="Debezium"><meta property="article:tag" content="Kafka-Connector"><meta name=twitter:card content="summary"><meta name=twitter:title content="Exporting Prometheus metrics from the Debezium Kafka connector"><meta name=twitter:description content="In this article, we will take a step-by-step look at how to configure the Debezium Kafka connector so that it starts sending metrics in Prometheus format over the HTTP protocol.
We will make the configuration by customizing the Docker image. At the end of the article we will get a Docker image ready for further manipulation (including deployment to production)."></head><body><a class=skip-main href=#main>Skip to main content</a><div class=container><header class=common-header><div class=header-top><h1 class=site-title><a href=/>Maksim Yakunin's blog</a></h1><ul class=social-icons id=social-icons><li><a href=https://github.com/iakunin title=Github rel=nofollow><span class=inline-svg><svg viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></span></a></li><li><a href=https://www.linkedin.com/in/iakunin title=Linkedin rel=nofollow><span class=inline-svg><svg viewBox="0 0 448 512"><path fill="currentcolor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg></span></a></li><li><a href=mailto:yakuninm+blog@gmail.com title=Email rel=nofollow><span class=inline-svg><svg viewBox="0 0 512 512"><path fill="currentcolor" d="M464 64H48C21.49 64 0 85.49.0 112v288c0 26.51 21.49 48 48 48h416c26.51.0 48-21.49 48-48V112c0-26.51-21.49-48-48-48zm0 48v40.805c-22.422 18.259-58.168 46.651-134.587 106.49-16.841 13.247-50.201 45.072-73.413 44.701-23.208.375-56.579-31.459-73.413-44.701C106.18 199.465 70.425 171.067 48 152.805V112h416zM48 4e2V214.398c22.914 18.251 55.409 43.862 104.938 82.646 21.857 17.205 60.134 55.186 103.062 54.955 42.717.231 80.509-37.199 103.053-54.947 49.528-38.783 82.032-64.401 104.947-82.653V4e2H48z"/></svg></span></a></li></ul></div><nav><a href=https://iakunin.dev/about/ title>About</a>
<a href=https://iakunin.dev/tags/ title>Tags</a>
<a href=https://iakunin.dev/posts/ title>All posts</a></nav><script type=text/javascript>(function(e,t,n,s,o,i,a){e[o]=e[o]||function(){(e[o].a=e[o].a||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)})(window,document,"script","https://mc.yandex.ru/metrika/tag.js","ym"),ym(86074134,"init",{clickmap:!0,trackLinks:!0,accurateTrackBounce:!0,webvisor:!0})</script><noscript><div><img src=https://mc.yandex.ru/watch/86074134 style=position:absolute;left:-9999px alt></div></noscript></header><main id=main tabindex=-1><article class="post h-entry"><header class=post-header><h1 class="p-name post-title">Exporting Prometheus metrics from the Debezium Kafka connector</h1></header><div class="content e-content"><p>In this article, we will take a step-by-step look at how to configure the <a href=https://debezium.io/>Debezium Kafka connector</a> so that it starts sending metrics in <a href=https://prometheus.io/docs/instrumenting/exposition_formats/>Prometheus format</a> over the HTTP protocol.</p><p>We will make the configuration by customizing the Docker image. At the end of the article we will get a Docker image ready for further manipulation (including deployment to production).</p><h2 id=before-you-start>Before you start</h2><p>In order to run the code examples given in the article, make sure that you have installed:</p><ul><li><a href=https://curl.se/download.html>cURL</a></li><li><a href=https://docs.docker.com/engine/install/>Docker</a></li><li><a href=https://docs.docker.com/compose/install/>Docker Compose</a></li></ul><h3 id=step-1-select-the-basic-docker-image>Step 1. Select the basic Docker image</h3><p>We use <code>debezium/connect:1.6</code> as the base Docker image.</p><p>Why this one? It&rsquo;s simple: version <code>1.6</code> is the most recent stable version at the time of writing.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> debezium/connect:1.6</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><h3 id=step-2-export-jmx-mbeans-in-prometheus-format>Step 2. Export JMX Mbeans in Prometheus format</h3><p>The official Debezium documentation <a href=https://debezium.io/documentation/reference/1.6/operations/monitoring.html>states</a> that JMX can be used to monitor the connector. In fact, JMX Mbeans are the only available way to monitor not only Kafka connectors, but also Apache Zookeeper, as well as Apache Kafka itself.</p><p>The Debezium documentation suggests configuring JMX via environment variables. This is not a mandatory step for exporting metrics to Prometheus. In our case, it is necessary to correctly install and configure <a href=https://github.com/prometheus/jmx_exporter>JMS Exporter Java agent</a>.</p><p>In the <a href=https://github.com/prometheus/jmx_exporter/blob/main/README.md>README</a> of this project, it is strongly recommended to use it specifically as a Java agent, but it is also allowed to install it as an independent http server (this option will not be considered in this article).</p><h3 id=step-21-download-jmx-exporter>Step 2.1. Download JMX Exporter</h3><p>Download JMX Exporter to the directory <code>$KAFKA_HOME/etc</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=color:#66d9ef>RUN</span> mkdir -p $KAFKA_HOME/etc <span style=color:#f92672>&amp;&amp;</span> cd $KAFKA_HOME/etc <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    curl -so jmx_prometheus_javaagent.jar <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    https://repo1.maven.org/maven2/io/prometheus/jmx/jmx_prometheus_javaagent/0.16.1/jmx_prometheus_javaagent-0.16.1.jar<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><h3 id=step-22-describe-the-configuration-for-jmx-exporter>Step 2.2. Describe the configuration for JMX Exporter</h3><p>The configuration for JMX Exporter must be described in YAML format. As a basic configuration, let&rsquo;s take <a href=https://github.com/debezium/debezium-examples/blob/cf8eaf05f3259dc51c2f9316f6c14a3b39b185fb/monitoring/debezium-jmx-exporter/config.yml>this example</a> from the <code>debezium-examples</code> repository:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=color:#66d9ef>RUN</span> cd $KAFKA_HOME/etc <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    curl -so metrics-config.yml <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    https://raw.githubusercontent.com/debezium/debezium-examples/cf8eaf05f3259dc51c2f9316f6c14a3b39b185fb/monitoring/debezium-jmx-exporter/config.yml<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>A more detailed description of all configuration options can be found in the <a href=https://github.com/prometheus/jmx_exporter/blob/ea03179c8691d5220813402fb29901d3c61a7c48/README.md#configuration>relevant README section</a> of <code>prometheus/jmx_exporter</code> project.</p><h3 id=step-23-set-the-javaagent-option-for-the-connector>Step 2.3. Set the <code>javaagent</code> option for the connector</h3><p>All that remains is to put everything together by specifying the <code>javaagent</code> option for the Kafka connector.
The environment variable <code>KAFKA_OPTS</code>, which is used to set all the JVM parameters of the java process of the Kafka connector, will help us in this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=color:#66d9ef>ARG</span> METRICS_PORT<span style=color:#f92672>=</span><span style=color:#ae81ff>8080</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>ENV</span> KAFKA_OPTS<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;-javaagent:</span>$KAFKA_HOME<span style=color:#e6db74>/etc/jmx_prometheus_javaagent.jar=</span>$METRICS_PORT<span style=color:#e6db74>:</span>$KAFKA_HOME<span style=color:#e6db74>/etc/metrics-config.yml&#34;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>If the <code>javaagent</code> option is set correctly, then the metrics should be available inside the Docker container at <code>http://localhost:8080/metrics </code>.</p><p>Below we will see this in practice.</p><h3 id=the-final-dockerfile>The final Dockerfile</h3><p>Throughout the article, we wrote the Dockerfile for the Kafka connector line by line.
If you put them together, the resulting Dockerfile will look like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> debezium/connect:1.6</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>ARG</span> JMX_AGENT_VERSION<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>.16.1<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>ARG</span> METRICS_PORT<span style=color:#f92672>=</span><span style=color:#ae81ff>8080</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Downloading jmx_prometheus_javaagent</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> mkdir -p $KAFKA_HOME/etc <span style=color:#f92672>&amp;&amp;</span> cd $KAFKA_HOME/etc <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    curl -so jmx_prometheus_javaagent.jar <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    https://repo1.maven.org/maven2/io/prometheus/jmx/jmx_prometheus_javaagent/$JMX_AGENT_VERSION/jmx_prometheus_javaagent-$JMX_AGENT_VERSION.jar<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Downloading example config for jmx_prometheus_javaagent</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> cd $KAFKA_HOME/etc <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    curl -so metrics-config.yml <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    https://raw.githubusercontent.com/debezium/debezium-examples/cf8eaf05f3259dc51c2f9316f6c14a3b39b185fb/monitoring/debezium-jmx-exporter/config.yml<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#75715e># Adding `-javaagent` argument to KAFKA_OPTS (JAVA_OPTS of Kafka process)</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>ENV</span> KAFKA_OPTS<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;-javaagent:</span>$KAFKA_HOME<span style=color:#e6db74>/etc/jmx_prometheus_javaagent.jar=</span>$METRICS_PORT<span style=color:#e6db74>:</span>$KAFKA_HOME<span style=color:#e6db74>/etc/metrics-config.yml&#34;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><h3 id=check-the-correctness-of-the-result>Check the correctness of the result</h3><p>If we try to run the resulting Docker image, we will get the following error:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>Connection to node -1 (/0.0.0.0:9092) could not be established.
</span></span><span style=display:flex><span>Broker may not be available.
</span></span></code></pre></div><p>In order to fix this error, we need to run a container with Apache Kafka.
In turn, Apache Kafka requires Apache Zookeeper for its work, which we will similarly run in a container.</p><p>Here, <code>docker-compose</code> will come to our aid, which will simplify our work with this set of Docker containers. I have prepared the <code>docker-compose.yml</code> file, in which I described the minimum configuration required to start the local Kafka connector:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>zookeeper</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>debezium/zookeeper:1.6</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>kafka</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>debezium/kafka:1.6</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>links</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>zookeeper</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>ZOOKEEPER_CONNECT=zookeeper:2181</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>debezium-connector</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>build</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>context</span>: <span style=color:#ae81ff>.</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>args</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>METRICS_PORT</span>: <span style=color:#ae81ff>8080</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#39;8080:8080&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>links</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>kafka</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>BOOTSTRAP_SERVERS=kafka:9092</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>GROUP_ID=1</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>CONFIG_STORAGE_TOPIC=my_connect_configs</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>OFFSET_STORAGE_TOPIC=my_connect_offsets</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>STATUS_STORAGE_TOPIC=my_connect_statuses</span>
</span></span></code></pre></div><p>This <code>docker-compose.yml</code> file should be placed next to the <code>Dockerfile</code> file described above.</p><p>It would be very convenient to take and run this bunch with a single command. Said &ndash; done!</p><p>Description of what the combo command below does:</p><ul><li>creates a temporary folder and goes to it,</li><li>downloads the &lsquo;docker-compose&rsquo; files.yml<code>and</code>Dockerfile`,</li><li>launches all services declared in <code>docker-compose.yml</code>
(including building a Docker image from a Dockerfile),</li><li>waits 60 seconds for the debezium connector to become available on localhost:8080,</li><li>and finally executes a command that outputs metrics in Prometheus format to the console,</li><li>after that, it stops all Docker containers, regardless of the success of the previous instructions.</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cd <span style=color:#66d9ef>$(</span>mktemp -d<span style=color:#66d9ef>)</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>curl -sO https://iakunin.dev/posts/debezium-kafka-connector-metrics/code/Dockerfile <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>curl -sO https://iakunin.dev/posts/debezium-kafka-connector-metrics/code/docker-compose.yml <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>docker-compose up --build --detach <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>timeout <span style=color:#ae81ff>60</span> bash -c <span style=color:#e6db74>&#34;while true; do if curl -I &#39;localhost:8080&#39; 2&gt;&amp;1 | grep -wq &#39;HTTP/1.1 200 OK&#39;; then exit 0; fi done&#34;</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>echo <span style=color:#e6db74>&#34;\n\n\n\n\n&#34;</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>curl <span style=color:#e6db74>&#39;http://localhost:8080/metrics&#39;</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>echo <span style=color:#e6db74>&#34;\n\n\n\n\n&#34;</span> ; <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>docker-compose down
</span></span></code></pre></div><p>The resulting output of this command should be
<a href=https://iakunin.dev/posts/debezium-kafka-connector-metrics/code/stdout.txt>something like this</a>.</p><p>If the stdout in your console is similar to it, then I did not deceive you and set up the metrics for the Kafka Debezium connector absolutely correctly. If something went wrong, then let me know about it (you can find my contacts in the <a href=/posts/debezium-kafka-connector-metrics/#social-icons>site header</a>).</p></div><div class=post-info><div class="post-date dt-published">2024-09-29</div><a class="post-hidden-url u-url" href=https://iakunin.dev/posts/debezium-kafka-connector-metrics/>https://iakunin.dev/posts/debezium-kafka-connector-metrics/</a>
<a href=https://iakunin.dev/ class="p-name p-author post-hidden-author h-card" rel=me>Maksim Yakunin</a><div class=post-taxonomies><ul class=post-tags><li><a href=https://iakunin.dev/tags/howto>#howto</a></li><li><a href=https://iakunin.dev/tags/metrics>#metrics</a></li><li><a href=https://iakunin.dev/tags/prometheus>#prometheus</a></li><li><a href=https://iakunin.dev/tags/debezium>#debezium</a></li><li><a href=https://iakunin.dev/tags/kafka-connector>#kafka-connector</a></li></ul></div></div></article><div class="pagination post-pagination"><div class="left pagination-item disabled"></div><div class="right pagination-item"><a href=/posts/elasticsearch-cheat-sheet/>ElasticSearch queries cheat sheet</a></div></div><div class=comments style=margin-top:3em><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//iakunin-dev-en.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a>
<script>new MutationObserver(function(e){e.forEach(function(e){if(e.type==="attributes"&&e.attributeName==="data-theme"){if(!DISQUS)return;DISQUS.reset({reload:!0})}})}).observe(document.documentElement,{attributes:!0})</script></div></main><footer class=common-footer><div class=common-footer-bottom><div class=copyright><p>© Maksim Yakunin, 2024<br>Powered by <a target=_blank rel="noopener noreferrer" href=https://gohugo.io/>Hugo</a>, theme <a target=_blank rel="noopener noreferrer" href=https://github.com/mitrichius/hugo-theme-anubis>Anubis</a>.<br>Hosted on
<a target=_blank rel="noopener noreferrer" href=https://pages.github.com/>GitHub Pages</a>.<br>Blog's source code is open and leaves on
<a target=_blank rel="noopener noreferrer" href=https://github.com/iakunin/blog>GitHub</a>.<br></p></div><button class=theme-switcher>
Dark theme
</button>
<script>const STORAGE_KEY="user-color-scheme",defaultTheme="auto";let currentTheme,switchButton,autoDefinedScheme=window.matchMedia("(prefers-color-scheme: dark)");const autoChangeScheme=e=>{currentTheme=e.matches?"dark":"light",document.documentElement.setAttribute("data-theme",currentTheme),changeButtonText()};document.addEventListener("DOMContentLoaded",function(){switchButton=document.querySelector(".theme-switcher"),currentTheme=detectCurrentScheme(),currentTheme=="dark"&&document.documentElement.setAttribute("data-theme","dark"),currentTheme=="auto"&&(autoChangeScheme(autoDefinedScheme),autoDefinedScheme.addListener(autoChangeScheme)),changeButtonText(),switchButton.addEventListener("click",switchTheme,!1)});function detectCurrentScheme(){return localStorage.getItem(STORAGE_KEY)?localStorage.getItem(STORAGE_KEY):defaultTheme?defaultTheme:window.matchMedia?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":"light"}function changeButtonText(){switchButton.textContent=currentTheme=="dark"?"Light theme":"Dark theme"}function switchTheme(){currentTheme=="dark"?(localStorage.setItem(STORAGE_KEY,"light"),document.documentElement.setAttribute("data-theme","light"),currentTheme="light"):(localStorage.setItem(STORAGE_KEY,"dark"),document.documentElement.setAttribute("data-theme","dark"),currentTheme="dark"),changeButtonText()}</script></div><p class="h-card vcard"><a href=https://iakunin.dev/ class="p-name u-url url fn" rel=me>Maksim Yakunin</a></p></footer></div></body></html>